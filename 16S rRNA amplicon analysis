###################Data-filtration
java -jar /home/Softwares/Trimmomatic-0.39/trimmomatic-0.39.jar PE EC_S1_R1.fastq EC_S1_R2.fastq EC_S1_R1_paired.fastq EC_S1_R1_unpaired.fastq EC_S1_R2_paired.fastq EC_S1_R2_unpaired.fastq ILLUMINACLIP:/home/Softwares/Trimmomatic-0.39/adapters/all_trueseq_PE.fa:2:30:10 LEADING:20 TRAILING:20 SLIDINGWINDOW:4:20 MINLEN:60 -threads 15

###################QIIME2 analysis
conda activate qiime2-2021.4

qiime tools import --type 'SampleData[PairedEndSequencesWithQuality]' --input-path Manifest.csv --output-path paired-end-demux.qza --input-format PairedEndFastqManifestPhred33
("Manifest.csv" file contains the sample IDs and the location of the filtered reads)
qiime demux summarize --i-data paired-end-demux.qza --o-visualization paired-end-demux.qzv

qiime dada2 denoise-paired --verbose --i-demultiplexed-seqs paired-end-demux.qza --p-trim-left-f 0 --p-trim-left-r 0 --p-trunc-len-f 240  --p-trunc-len-r 200 --o-table table.qza --o-representative-sequences rep
-seqs.qza --p-n-threads 120

qiime tools export --input-path table.qza --output-path exported-feature-table

biom convert -i feature-table.biom -o feature-table.tsv --to-tsv

qiime metadata tabulate --m-input-file metadata.tsv --o-visualization tabulated-metadata.qzv

qiime feature-table summarize --i-table table.qza --o-visualization table.qzv --m-sample-metadata-file Metadata.tsv --verbose

qiime feature-table tabulate-seqs --i-data rep-seqs.qza --o-visualization rep-seqs.qzv

qiime alignment mafft --i-sequences rep-seqs.qza --o-alignment aligned-rep-seqs.qza --p-n-threads 25

qiime alignment mask --i-alignment aligned-rep-seqs.qza --o-masked-alignment masked-aligned-rep-seqs.qza

qiime phylogeny fasttree --i-alignment masked-aligned-rep-seqs.qza --o-tree unrooted-tree.qza

qiime phylogeny midpoint-root --i-tree unrooted-tree.qza --o-rooted-tree rooted-tree.qza

#### Already available classifier for SILVA database v3 region was downloaded from https://github.com/anweshmaile/silva-138_classifiers

qiime feature-classifier classify-sklearn --i-classifier classifier.qza --i-reads rep-seqs.qza --o-classification taxonomy.qza

###################

qiime taxa collapse --i-table table.qza  --i-taxonomy taxonomy.qza --p-level 6 --o-collapsed-table table-l6.qza
qiime taxa collapse --i-table table.qza  --i-taxonomy taxonomy.qza --p-level 5 --o-collapsed-table table-l5.qza
qiime taxa collapse --i-table table.qza  --i-taxonomy taxonomy.qza --p-level 2 --o-collapsed-table table-l2.qza

qiime tools export --input-path table-l6.qza --output-path exported-table-l6
qiime tools export --input-path table-l5.qza --output-path exported-table-l5
qiime tools export --input-path table-l2.qza --output-path exported-table-l2

